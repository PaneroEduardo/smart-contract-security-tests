# Configuración del contrato
CONTRACT_NAME := Exploit
CONTRACT_FILE := $(CONTRACT_NAME).sol

DEPLOY_FOLDER := ./deploy
BUILD_FOLDER := ./build

CONTRACT_ADDRESS_FILE := $(DEPLOY_FOLDER)/$(CONTRACT_NAME).address

# Configuración de la conexión con Ganache
GANACHE_URL := http://localhost:8545
GANACHE_NETWORK_ID := 5777

# Compilar el contrato
.PHONY: compile
compile:
	@echo "Compilando contrato $(CONTRACT_NAME)..."
	truffle compile --network ganache
	@echo "Contrato compilado."

# Desplegar el contrato en Ganache
.PHONY: deploy
deploy:
	@echo "Deploying contract $(CONTRACT_NAME) in Ganache... $(SHARED_WALLET_CONTRACT_ADDRESS)"
	mkdir -p $(DEPLOY_FOLDER)
	truffle migrate --network ganache --contract-address=$(SHARED_WALLET_CONTRACT_ADDRESS)
	make get-contract-address
	
.PHONY: get-contract-address
get-contract-address:
	echo $$(truffle networks --network ganache | grep $(CONTRACT_NAME) | awk '{print $$2}') > $(CONTRACT_ADDRESS_FILE)
	@echo "Contract deployed in $$(cat $(CONTRACT_ADDRESS_FILE))."

.PHONE: down
down:
	rm -rf $(DEPLOY_FOLDER)
	rm -rf $(BUILD_FOLDER)